<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Portfolio - AlphaAnalytics</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Inter', sans-serif;
}

:root {
  --primary-white: #ffffff;
  --bg-gradient: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
  --bg-dark: #0f0f23;
  --bg-card: rgba(30, 30, 46, 0.8);
  --bg-card-hover: rgba(40, 40, 62, 0.9);
  --text-primary: #ffffff;
  --text-secondary: #a0a0c0;
  --text-muted: #707090;
  --border-color: rgba(255, 255, 255, 0.1);
  --hover-color: rgba(0, 230, 255, 0.15);
  --active-color: #00e6ff;
  --up-color: #00ff9d;
  --down-color: #ff4d7c;
  --accent-blue: #00e6ff;
  --accent-teal: #00ff9d;
  --accent-purple: #8a2be2;
  --accent-pink: #ff4d7c;
  --shadow-glow: 0 0 20px rgba(0, 230, 255, 0.3);
  --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.2);
}

body.light {
  --bg-gradient: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  --bg-dark: #ffffff;
  --bg-card: rgba(255, 255, 255, 0.9);
  --bg-card-hover: rgba(255, 255, 255, 1);
  --text-primary: #1e293b;
  --text-secondary: #475569;
  --text-muted: #64748b;
  --border-color: rgba(0, 0, 0, 0.1);
  --hover-color: rgba(0, 230, 255, 0.1);
  --active-color: #0077cc;
  --shadow-glow: 0 0 20px rgba(0, 119, 204, 0.2);
  --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.1);
}

body {
  background: var(--bg-gradient);
  color: var(--text-primary);
  transition: all 0.4s ease;
  min-height: 100vh;
  line-height: 1.6;
}

.container {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  max-width: 1400px;
  margin: 0 auto;
}

/* Enhanced Navbar */
.navbar {
  background: rgba(15, 15, 35, 0.9);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border-color);
  position: sticky;
  top: 0;
  z-index: 1000;
  padding: 0;
}

.nav-wrap {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 20px;
}

.nav-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 0;
}

.logo {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 28px;
  font-weight: 700;
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  display: flex;
  align-items: center;
  gap: 8px;
}

.logo i {
  font-size: 24px;
}

.nav-items {
  display: flex;
  gap: 8px;
  list-style: none;
}

.nav-item {
  padding: 10px 16px;
  border-radius: 12px;
  color: var(--text-secondary);
  text-decoration: none;
  font-weight: 500;
  font-size: 14px;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 6px;
}

.nav-item:hover {
  background: var(--hover-color);
  color: var(--active-color);
  transform: translateY(-2px);
}

.nav-item.active {
  background: var(--active-color);
  color: var(--bg-dark);
  box-shadow: var(--shadow-glow);
}

.menu-toggle {
  display: none;
  flex-direction: column;
  gap: 4px;
  background: none;
  border: none;
  cursor: pointer;
  padding: 8px;
}

.menu-toggle span {
  width: 24px;
  height: 2px;
  background: var(--text-primary);
  border-radius: 2px;
  transition: all 0.3s ease;
}

/* Mobile Menu Animation */
.menu-toggle span.active:nth-child(1) {
  transform: rotate(45deg) translate(6px, 6px);
}

.menu-toggle span.active:nth-child(2) {
  opacity: 0;
}

.menu-toggle span.active:nth-child(3) {
  transform: rotate(-45deg) translate(6px, -6px);
}

/* Ensure mobile menu displays properly */
@media (max-width: 768px) {
  .nav-items {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--bg-dark);
    border-top: 1px solid var(--border-color);
    padding: 16px;
    flex-direction: column;
    gap: 8px;
    z-index: 1000;
  }
  
  .nav-items.show {
    display: flex;
  }
  
  .nav-item {
    padding: 12px 16px;
    border-radius: 8px;
    justify-content: flex-start;
  }
  
  .menu-toggle {
    display: flex;
  }
}

/* Main Content */
.main-content {
  flex: 1;
  padding: 24px;
}

/* Header Section */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 32px;
  flex-wrap: wrap;
  gap: 20px;
}

.header h1 {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 32px;
  font-weight: 700;
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.header-controls {
  display: flex;
  gap: 16px;
  align-items: center;
}

/* Search Bar */
.search-container {
  position: relative;
  width: 400px;
  max-width: 100%;
}

.search-bar {
  width: 100%;
  padding: 14px 20px 14px 48px;
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: 16px;
  color: var(--text-primary);
  font-size: 15px;
  font-weight: 500;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.search-bar:focus {
  outline: none;
  border-color: var(--active-color);
  box-shadow: var(--shadow-glow);
}

.search-icon {
  position: absolute;
  left: 16px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-muted);
  font-size: 18px;
}

/* Action Buttons */
.action-buttons {
  display: flex;
  gap: 12px;
}

.btn {
  padding: 12px 20px;
  border: none;
  border-radius: 12px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
}

.btn-primary {
  background: var(--active-color);
  color: var(--bg-dark);
  box-shadow: var(--shadow-glow);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 30px rgba(0, 230, 255, 0.5);
}

.btn-secondary {
  background: var(--bg-card);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
}

.btn-secondary:hover {
  background: var(--bg-card-hover);
  border-color: var(--active-color);
}

/* Portfolio Overview */
.portfolio-overview {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin-bottom: 32px;
}

.portfolio-card {
  background: var(--bg-card);
  padding: 24px;
  border-radius: 20px;
  border: 1px solid var(--border-color);
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  position: relative;
  overflow: hidden;
}

.portfolio-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--accent-blue), var(--accent-teal));
}

.portfolio-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-card);
  border-color: var(--active-color);
}

.portfolio-card h3 {
  color: var(--text-secondary);
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.portfolio-value {
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 8px;
  font-family: 'Space Grotesk', sans-serif;
}

.portfolio-change {
  font-size: 14px;
  font-weight: 600;
  padding: 6px 12px;
  border-radius: 20px;
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

.portfolio-change.positive {
  background: rgba(0, 255, 157, 0.15);
  color: var(--up-color);
}

.portfolio-change.negative {
  background: rgba(255, 77, 124, 0.15);
  color: var(--down-color);
}

/* Portfolio Sentiment */
.portfolio-sentiment {
  background: var(--bg-card);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 24px;
  border: 1px solid var(--border-color);
  backdrop-filter: blur(10px);
}

.sentiment-content {
  display: flex;
  align-items: center;
  gap: 16px;
}

.sentiment-icon {
  font-size: 32px;
  color: var(--active-color);
}

.sentiment-text {
  flex: 1;
}

.sentiment-text h3 {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 4px;
}

/* AI Insight */
.ai-insight {
  background: var(--bg-card);
  border-radius: 20px;
  padding: 24px;
  margin-bottom: 24px;
  border: 1px solid var(--border-color);
  backdrop-filter: blur(10px);
}

.ai-insight-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
}

.ai-insight-header h3 {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 18px;
  font-weight: 700;
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.ai-icon {
  font-size: 20px;
  color: var(--active-color);
}

.ai-content {
  color: var(--text-primary);
  font-size: 15px;
  line-height: 1.6;
}

/* Holdings Section */
.holdings-section {
  background: var(--bg-card);
  border-radius: 20px;
  padding: 24px;
  border: 1px solid var(--border-color);
  backdrop-filter: blur(10px);
}

.holdings-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  flex-wrap: wrap;
  gap: 16px;
}

.holdings-header h2 {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 24px;
  font-weight: 700;
}

.holdings-controls {
  display: flex;
  gap: 12px;
  align-items: center;
  flex-wrap: wrap;
}

.control-select, .control-input {
  padding: 10px 16px;
  background: var(--bg-dark);
  border: 1px solid var(--border-color);
  border-radius: 12px;
  color: var(--text-primary);
  font-size: 14px;
  font-weight: 500;
  transition: all 0.3s ease;
}

.control-select:focus, .control-input:focus {
  outline: none;
  border-color: var(--active-color);
}

.holdings-list {
  border-top: 1px solid var(--border-color);
}

.holding-item {
  display: grid;
  grid-template-columns: 2fr 1fr 1fr 1fr;
  gap: 20px;
  padding: 20px 0;
  border-bottom: 1px solid var(--border-color);
  align-items: center;
  transition: all 0.3s ease;
  cursor: pointer;
  border-radius: 12px;
}

.holding-item:hover {
  background: var(--hover-color);
  transform: translateX(8px);
}

.holding-info {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.holding-name {
  font-weight: 600;
  font-size: 16px;
  color: var(--text-primary);
}

.holding-symbol {
  color: var(--text-muted);
  font-size: 14px;
  font-weight: 500;
}

.holding-price {
  font-weight: 600;
  font-size: 16px;
  text-align: right;
}

.holding-change {
  font-weight: 600;
  font-size: 14px;
  text-align: right;
  padding: 6px 12px;
  border-radius: 20px;
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

.holding-change.positive {
  background: rgba(0, 255, 157, 0.15);
  color: var(--up-color);
}

.holding-change.negative {
  background: rgba(255, 77, 124, 0.15);
  color: var(--down-color);
}

.holding-actions {
  display: flex;
  gap: 8px;
  justify-content: flex-end;
}

.action-btn {
  padding: 6px 12px;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  background: var(--bg-dark);
  color: var(--text-secondary);
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 12px;
  font-weight: 500;
}

.action-btn:hover {
  background: var(--active-color);
  color: var(--bg-dark);
  border-color: var(--active-color);
}

/* Shimmer Loading */
.shimmer {
  background: linear-gradient(90deg, var(--bg-dark) 25%, var(--bg-card) 50%, var(--bg-dark) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 4px;
}

@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

/* Responsive Design */
@media (max-width: 1200px) {
  .nav-items {
    gap: 4px;
  }
  
  .nav-item {
    padding: 8px 12px;
    font-size: 13px;
  }
  
  .search-container {
    width: 300px;
  }
}

@media (max-width: 768px) {
  .navbar {
    padding: 0 16px;
  }
  
  .nav-row {
    flex-wrap: wrap;
  }
  
  .menu-toggle {
    display: flex;
  }
  
  .nav-items {
    display: none;
    width: 100%;
    flex-direction: column;
    gap: 8px;
    margin-top: 16px;
  }
  
  .nav-items.show {
    display: flex;
  }
  
  .header {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .header-controls {
    width: 100%;
    justify-content: space-between;
  }
  
  .search-container {
    width: 100%;
  }
  
  .portfolio-overview {
    grid-template-columns: 1fr;
  }
  
  .holding-item {
    grid-template-columns: 1fr auto auto;
    gap: 12px;
  }
  
  .holding-actions {
    display: none;
  }
  
  .holdings-controls {
    flex-direction: column;
    width: 100%;
  }
  
  .control-select, .control-input {
    width: 100%;
  }
}

@media (max-width: 480px) {
  .main-content {
    padding: 16px;
  }
  
  .header h1 {
    font-size: 24px;
  }
  
  .portfolio-card {
    padding: 20px;
  }
  
  .holdings-section {
    padding: 20px;
  }
}
</style>
</head>
<body>
<div class="container">
  <!-- Enhanced Navbar -->
  <header class="navbar">
    <div class="nav-wrap">
      <div class="nav-row">
        <div class="logo">
          <i class="fas fa-chart-line"></i>
          AlphaAnalytics
        </div>
        
        <button class="menu-toggle" aria-label="Toggle menu">
          <span></span>
          <span></span>
          <span></span>
        </button>

        <nav class="nav-items">
          <a href="jeet.html" class="nav-item">
            <i class="fas fa-home"></i>Dashboard
          </a>
          <a href="portfolio.html" class="nav-item active">
            <i class="fas fa-briefcase"></i>Portfolio
          </a>
          <a href="mystock.html" class="nav-item">
            <i class="fas fa-star"></i>My Stock
          </a>
          <a href="deposit.html" class="nav-item">
            <i class="fas fa-wallet"></i>Deposit
          </a>
          <a href="insight.html" class="nav-item">
            <i class="fas fa-brain"></i>Insight
          </a>
          <a href="prediction.html" class="nav-item">
            <i class="fas fa-crystal-ball"></i>Prediction
          </a>
          <a href="news.html" class="nav-item">
            <i class="fas fa-newspaper"></i>News
          </a>
          <a href="videos.html" class="nav-item">
            <i class="fas fa-play-circle"></i>Videos
          </a>
          <a href="Superstars.html" class="nav-item">
            <i class="fas fa-trophy"></i>Superstars
          </a>
          <a href="alerts.html" class="nav-item">
            <i class="fas fa-bell"></i>Alerts
          </a>
          <a href="help.html" class="nav-item">
            <i class="fas fa-question-circle"></i>Help
          </a>
          <a href="profile.html" class="nav-item">
            <i class="fas fa-user"></i>Profile
          </a>
        </nav>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header Section -->
    <div class="header">
      <h1>Portfolio Overview</h1>
      <div class="header-controls">
        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input type="text" class="search-bar" placeholder="Search holdings..." id="searchBar">
        </div>
        <div class="action-buttons">
          <button class="btn btn-primary" onclick="exportPortfolio()">
            <i class="fas fa-download"></i>Export
          </button>
          <button class="btn btn-secondary" onclick="toggleTheme()">
            <i class="fas fa-palette"></i>Theme
          </button>
        </div>
      </div>
    </div>

    <!-- Portfolio Sentiment -->
    <div class="portfolio-sentiment">
      <div class="sentiment-content">
        <i class="fas fa-chart-line sentiment-icon"></i>
        <div class="sentiment-text">
          <h3 id="portfolioSentiment">Portfolio Performance: Analyzing...</h3>
          <p>Real-time portfolio analysis and performance tracking</p>
        </div>
      </div>
    </div>

    <!-- AI Insight -->
    <div class="ai-insight">
      <div class="ai-insight-header">
        <i class="fas fa-robot ai-icon"></i>
        <h3>AI Portfolio Intelligence</h3>
      </div>
      <div class="ai-content" id="aiInsightText">
        Analyzing your portfolio performance and generating personalized insights...
      </div>
    </div>

    <!-- Portfolio Overview -->
    <div class="portfolio-overview" id="portfolioOverview">
      <!-- Portfolio cards will be populated by JavaScript -->
    </div>

    <!-- Holdings Section -->
    <div class="holdings-section">
      <div class="holdings-header">
        <h2>Portfolio Holdings</h2>
        <div class="holdings-controls">
          <select class="control-select" id="sortHoldings">
            <option value="">Sort By</option>
            <option value="name">Name</option>
            <option value="price">Price</option>
            <option value="change">Performance</option>
          </select>
          <input type="text" class="control-input" id="filterHolding" placeholder="Filter by symbol...">
        </div>
      </div>
      <div class="holdings-list" id="holdingsList">
        <!-- Holdings will be populated by JavaScript -->
      </div>
    </div>
  </main>
</div>

<script>
// Global variables
const TWELVEDATA_API_KEY = "55d0096fb3364d53bb6dc8d519aa35da";
let portfolioData = { 
  value: 125847, 
  gain: 2847, 
  invest: 123000, 
  funds: 2850, 
  allocation: "Tech: 65%, Finance: 20%, Other: 15%" 
};

let holdings = [
  { name: "Microsoft Corporation", symbol: "MSFT", shares: 15, avgPrice: 320.50 },
  { name: "Apple Inc.", symbol: "AAPL", shares: 25, avgPrice: 175.20 },
  { name: "Cisco Systems", symbol: "CSCO", shares: 45, avgPrice: 48.75 },
  { name: "Alibaba Group", symbol: "BABA", shares: 30, avgPrice: 85.40 },
  { name: "Meta Platforms", symbol: "META", shares: 12, avgPrice: 310.25 },
  { name: "NVIDIA Corporation", symbol: "NVDA", shares: 8, avgPrice: 420.80 }
];

// Mobile menu functionality
document.addEventListener('DOMContentLoaded', function() {
  const menuToggle = document.querySelector('.menu-toggle');
  const navItems = document.querySelector('.nav-items');
  
  if (menuToggle && navItems) {
    menuToggle.addEventListener('click', function() {
      navItems.classList.toggle('show');
      // Animate hamburger to X
      const spans = menuToggle.querySelectorAll('span');
      spans.forEach(span => span.classList.toggle('active'));
    });
    
    // Close menu when clicking outside
    document.addEventListener('click', function(event) {
      if (!event.target.closest('.navbar') && navItems.classList.contains('show')) {
        navItems.classList.remove('show');
        const spans = menuToggle.querySelectorAll('span');
        spans.forEach(span => span.classList.remove('active'));
      }
    });
  }

  // Initialize search and filter functionality
  const searchBar = document.getElementById('searchBar');
  const filterHolding = document.getElementById('filterHolding');
  const sortHoldings = document.getElementById('sortHoldings');
  
  searchBar.addEventListener('input', applyHoldingsFilter);
  filterHolding.addEventListener('input', applyHoldingsFilter);
  sortHoldings.addEventListener('change', applyHoldingsFilter);

  // Initialize portfolio data
  renderPortfolioCards();
  updatePortfolioSentiment();
  updateHoldingsLiveData();
  updateAIInsight();

  // Update AI insights periodically
  setInterval(updateAIInsight, 10000);
  
  // Update live data every 2 minutes
  setInterval(updateHoldingsLiveData, 120000);
});

// Helper function to wait
const wait = ms => new Promise(res => setTimeout(res, ms));

async function fetchLiveStockDataBatch(symbols) {
  if (!symbols.length) return [];
  let batchSize = 8; 
  let results = [];
  
  for (let i = 0; i < symbols.length; i += batchSize) {
    let batch = symbols.slice(i, i + batchSize);
    const url = `https://api.twelvedata.com/quote?symbol=${batch.join(",")}&apikey=${TWELVEDATA_API_KEY}`;
    try {
      const response = await fetch(url);
      if (!response.ok) throw new Error("Network error");
      const json = await response.json();
      let batchResults = Object.values(json).filter(s => s && !s.code && s.close !== undefined);
      results = results.concat(batchResults);
    } catch (e) { 
      console.error("Fetch error:", e); 
    }
    await wait(1200);
  }
  return results;
}

function getPercentChange(stock) {
  if (!stock.open || stock.open === 0) return 0;
  return ((stock.close - stock.open) / stock.open) * 100;
}

function renderPortfolioCards() {
  const gainPercentage = ((portfolioData.gain / portfolioData.invest) * 100).toFixed(2);
  const changeClass = portfolioData.gain >= 0 ? "positive" : "negative";
  const changeIcon = portfolioData.gain >= 0 ? "fa-caret-up" : "fa-caret-down";
  
  document.getElementById('portfolioOverview').innerHTML = `
    <div class="portfolio-card">
      <h3>Portfolio Value</h3>
      <div class="portfolio-value">$${portfolioData.value.toLocaleString()}</div>
      <span class="portfolio-change ${changeClass}">
        <i class="fas ${changeIcon}"></i>$${portfolioData.gain.toLocaleString()} (${gainPercentage}%)
      </span>
    </div>
    <div class="portfolio-card">
      <h3>Total Invested</h3>
      <div class="portfolio-value">$${portfolioData.invest.toLocaleString()}</div>
      <div style="color: var(--text-muted); font-size: 14px;">Initial Capital</div>
    </div>
    <div class="portfolio-card">
      <h3>Available Funds</h3>
      <div class="portfolio-value">$${portfolioData.funds.toLocaleString()}</div>
      <div style="color: var(--text-muted); font-size: 14px;">Ready to Invest</div>
    </div>
    <div class="portfolio-card">
      <h3>Sector Allocation</h3>
      <div class="portfolio-value" style="font-size: 18px;">${portfolioData.allocation}</div>
      <div style="color: var(--text-muted); font-size: 14px;">Diversification</div>
    </div>`;
}

function updatePortfolioSentiment() {
  const sentiment = portfolioData.gain > 0 ? "POSITIVE ðŸŸ¢" : "NEGATIVE ðŸ”´";
  const description = portfolioData.gain > 0 ? 
    `Your portfolio is up $${portfolioData.gain.toLocaleString()} today. Strong performance!` :
    `Your portfolio is down $${Math.abs(portfolioData.gain).toLocaleString()} today. Market volatility detected.`;
  
  document.getElementById('portfolioSentiment').textContent = `Portfolio Performance: ${sentiment}`;
}

function showLoadingPlaceholder(count = 6) {
  const el = document.getElementById('holdingsList');
  el.innerHTML = '';
  for (let i = 0; i < count; i++) {
    const holdingItem = document.createElement('div');
    holdingItem.className = 'holding-item';
    holdingItem.innerHTML = `
      <div class="holding-info">
        <div class="shimmer" style="width: 140px; height: 20px;"></div>
        <div class="shimmer" style="width: 80px; height: 16px; margin-top: 6px;"></div>
      </div>
      <div class="shimmer" style="width: 80px; height: 20px;"></div>
      <div class="shimmer" style="width: 90px; height: 20px;"></div>
      <div class="shimmer" style="width: 100px; height: 20px;"></div>`;
    el.appendChild(holdingItem);
  }
}

function renderHoldings(data) {
  const el = document.getElementById('holdingsList');
  el.innerHTML = '';
  
  data.forEach(h => {
    const div = document.createElement('div');
    div.className = 'holding-item';
    
    const changeClass = (h.change ?? 0) >= 0 ? 'positive' : 'negative';
    const changeArrow = (h.change ?? 0) >= 0 ? 'â†‘' : 'â†“';
    const priceFormatted = h.price !== undefined ? `$${parseFloat(h.price).toFixed(2)}` : 'Loading...';
    const changeFormatted = h.change !== undefined ? 
      `${h.change >= 0 ? '+' : ''}${parseFloat(h.change).toFixed(2)}% ${changeArrow}` : '';
    
    div.innerHTML = `
      <div class="holding-info">
        <span class="holding-name">${h.name}</span>
        <span class="holding-symbol">${h.symbol} â€¢ ${h.shares} shares</span>
      </div>
      <span class="holding-price">${priceFormatted}</span>
      <span class="holding-change ${changeClass}">${changeFormatted}</span>
      <div class="holding-actions">
        <button class="action-btn" onclick="tradeStock('${h.symbol}', 'buy')">Buy</button>
        <button class="action-btn" onclick="tradeStock('${h.symbol}', 'sell')">Sell</button>
      </div>`;
    
    el.appendChild(div);
  });
}

async function updateHoldingsLiveData() {
  showLoadingPlaceholder();
  const symbols = holdings.map(h => h.symbol);
  const data = await fetchLiveStockDataBatch(symbols);
  
  if (!data.length) return;
  
  data.forEach(d => {
    const idx = holdings.findIndex(h => h.symbol.toUpperCase() === d.symbol.toUpperCase());
    if (idx !== -1) {
      holdings[idx].price = parseFloat(d.close);
      holdings[idx].change = d.percent_change !== undefined ? 
        parseFloat(d.percent_change) : getPercentChange(d);
    }
  });
  
  renderHoldings(holdings);
}

function applyHoldingsFilter() {
  let arr = [...holdings];
  const sort = document.getElementById('sortHoldings').value;
  const filter = document.getElementById('filterHolding').value.toLowerCase();
  
  if (filter) {
    arr = arr.filter(h => 
      h.symbol.toLowerCase().includes(filter) || 
      h.name.toLowerCase().includes(filter)
    );
  }
  
  if (sort === "name") arr.sort((a, b) => a.name.localeCompare(b.name));
  if (sort === "price") arr.sort((a, b) => (b.price || 0) - (a.price || 0));
  if (sort === "change") arr.sort((a, b) => (b.change || 0) - (a.change || 0));
  
  renderHoldings(arr);
}

function exportPortfolio() {
  let csv = "Name,Symbol,Shares,Current Price,Change%,Current Value\n" + 
    holdings.map(h => {
      const price = h.price !== undefined ? parseFloat(h.price).toFixed(2) : '';
      const change = h.change !== undefined ? parseFloat(h.change).toFixed(2) : '';
      const value = h.price && h.shares ? (h.price * h.shares).toFixed(2) : '';
      return `${h.name},${h.symbol},${h.shares},${price},${change},${value}`;
    }).join("\n");
  
  let blob = new Blob([csv], { type: 'text/csv' });
  let a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = "alphaanalytics_portfolio.csv";
  a.click();
}

function toggleTheme() {
  document.body.classList.toggle('light');
}

function tradeStock(symbol, action) {
  alert(`${action.toUpperCase()} order placed for ${symbol}. This would connect to your trading platform.`);
}

function updateAIInsight() {
  const insights = [
    "AI analysis shows your tech-heavy portfolio is outperforming the market. Consider rebalancing to maintain diversification.",
    "Strong momentum detected in your holdings. NVIDIA and Microsoft showing exceptional growth potential.",
    "Portfolio volatility is within optimal range. Current allocation demonstrates good risk management.",
    "AI recommends considering additional exposure to emerging markets for enhanced diversification."
  ];
  const idx = Math.floor(Math.random() * insights.length);
  document.getElementById('aiInsightText').textContent = insights[idx];
}
</script>
</body>
</html>