<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AlphaAnalytics - Advanced Market Intelligence</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lightweight-charts/4.0.1/lightweight-charts.standalone.production.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-white: #ffffff;
      --bg-gradient: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
      --bg-dark: #0f0f23;
      --bg-card: rgba(30, 30, 46, 0.8);
      --bg-card-hover: rgba(40, 40, 62, 0.9);
      --text-primary: #ffffff;
      --text-secondary: #a0a0c0;
      --text-muted: #707090;
      --border-color: rgba(255, 255, 255, 0.1);
      --hover-color: rgba(0, 230, 255, 0.15);
      --active-color: #00e6ff;
      --up-color: #00ff9d;
      --down-color: #ff4d7c;
      --accent-blue: #00e6ff;
      --accent-teal: #00ff9d;
      --accent-purple: #8a2be2;
      --accent-pink: #ff4d7c;
      --shadow-glow: 0 0 20px rgba(0, 230, 255, 0.3);
      --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    body.light {
      --bg-gradient: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      --bg-dark: #ffffff;
      --bg-card: rgba(255, 255, 255, 0.9);
      --bg-card-hover: rgba(255, 255, 255, 1);
      --text-primary: #1e293b;
      --text-secondary: #475569;
      --text-muted: #64748b;
      --border-color: rgba(0, 0, 0, 0.1);
      --hover-color: rgba(0, 230, 255, 0.1);
      --active-color: #0077cc;
      --shadow-glow: 0 0 20px rgba(0, 119, 204, 0.2);
      --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    body {
      background: var(--bg-gradient);
      color: var(--text-primary);
      transition: all 0.4s ease;
      min-height: 100vh;
      line-height: 1.6;
    }

    .container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Enhanced Navbar */
    .navbar {
      background: rgba(15, 15, 35, 0.9);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 1000;
      padding: 0;
    }

    .nav-wrap {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .nav-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0;
    }

    .logo {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logo i {
      font-size: 24px;
    }

    .nav-items {
      display: flex;
      gap: 8px;
      list-style: none;
    }

    .nav-item {
      padding: 10px 16px;
      border-radius: 12px;
      color: var(--text-secondary);
      text-decoration: none;
      font-weight: 500;
      font-size: 14px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .nav-item:hover {
      background: var(--hover-color);
      color: var(--active-color);
      transform: translateY(-2px);
    }

    .nav-item.active {
      background: var(--active-color);
      color: var(--bg-dark);
      box-shadow: var(--shadow-glow);
    }

    .menu-toggle {
      display: none;
      flex-direction: column;
      gap: 4px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
    }

    .menu-toggle span {
      width: 24px;
      height: 2px;
      background: var(--text-primary);
      border-radius: 2px;
      transition: all 0.3s ease;
    }

    /* Mobile Menu Animation */
    .menu-toggle span {
      transition: all 0.3s ease;
    }

    .menu-toggle span.active:nth-child(1) {
      transform: rotate(45deg) translate(6px, 6px);
    }

    .menu-toggle span.active:nth-child(2) {
      opacity: 0;
    }

    .menu-toggle span.active:nth-child(3) {
      transform: rotate(-45deg) translate(6px, -6px);
    }

    /* Ensure mobile menu displays properly */
    @media (max-width: 768px) {
      .nav-items {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: var(--bg-dark);
        border-top: 1px solid var(--border-color);
        padding: 16px;
        flex-direction: column;
        gap: 8px;
        z-index: 1000;
      }
      
      .nav-items.show {
        display: flex;
      }
      
      .nav-item {
        padding: 12px 16px;
        border-radius: 8px;
        justify-content: flex-start;
      }
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: 24px;
    }

    /* Header Section */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
      flex-wrap: wrap;
      gap: 20px;
    }

    .header h1 {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 32px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .header-controls {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    /* Enhanced Search Bar */
    .search-container {
      position: relative;
      width: 400px;
      max-width: 100%;
    }

    .search-bar {
      width: 100%;
      padding: 14px 20px 14px 48px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      color: var(--text-primary);
      font-size: 15px;
      font-weight: 500;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .search-bar:focus {
      outline: none;
      border-color: var(--active-color);
      box-shadow: var(--shadow-glow);
    }

    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      font-size: 18px;
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 12px;
    }

    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--active-color);
      color: var(--bg-dark);
      box-shadow: var(--shadow-glow);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 30px rgba(0, 230, 255, 0.5);
    }

    .btn-secondary {
      background: var(--bg-card);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: var(--bg-card-hover);
      border-color: var(--active-color);
    }

    /* Market Overview */
    .market-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .market-card {
      background: var(--bg-card);
      padding: 24px;
      border-radius: 20px;
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    .market-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent-blue), var(--accent-teal));
    }

    .market-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-card);
      border-color: var(--active-color);
    }

    .market-card h3 {
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .market-value {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
      font-family: 'Space Grotesk', sans-serif;
    }

    .stock-change {
      font-size: 14px;
      font-weight: 600;
      padding: 6px 12px;
      border-radius: 20px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .stock-change.positive {
      background: rgba(0, 255, 157, 0.15);
      color: var(--up-color);
    }

    .stock-change.negative {
      background: rgba(255, 77, 124, 0.15);
      color: var(--down-color);
    }

    /* Chart Container */
    .chart-section {
      margin-bottom: 32px;
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .chart-header h2 {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 24px;
      font-weight: 700;
    }

    .chart-container {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 0;
      height: 500px;
      border: 1px solid var(--border-color);
      backdrop-filter: blur(10px);
      overflow: hidden;
    }

    /* TradingView Widget */
    .tradingview-widget-container {
      height: 100%;
      width: 100%;
      border-radius: 20px;
    }

    .chart-controls {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .chart-select {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      padding: 8px 16px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .chart-select:focus {
      outline: none;
      border-color: var(--active-color);
    }

    /* AI Insight */
    .ai-insight {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid var(--border-color);
      backdrop-filter: blur(10px);
    }

    .ai-insight-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .ai-insight-header h3 {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 18px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .ai-icon {
      font-size: 20px;
      color: var(--active-color);
    }

    .ai-content {
      color: var(--text-primary);
      font-size: 15px;
      line-height: 1.6;
    }

    /* News Ticker */
    .news-ticker {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 16px 24px;
      margin-bottom: 24px;
      border: 1px solid var(--border-color);
      backdrop-filter: blur(10px);
      overflow: hidden;
      position: relative;
    }

    .ticker-content {
      display: flex;
      align-items: center;
      gap: 16px;
      animation: ticker 30s linear infinite;
    }

    .ticker-item {
      display: flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
      color: var(--active-color);
      font-weight: 500;
    }

    .ticker-badge {
      background: var(--active-color);
      color: var(--bg-dark);
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
    }

    @keyframes ticker {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }

    /* Watchlist Section */
    .watchlist-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }

    .watchlist {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 24px;
      border: 1px solid var(--border-color);
      backdrop-filter: blur(10px);
    }

    .watchlist-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 12px;
    }

    .watchlist-header h2 {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 20px;
      font-weight: 700;
    }

    .sort-buttons {
      display: flex;
      gap: 8px;
    }

    .sort-btn {
      padding: 8px 16px;
      background: var(--bg-dark);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      color: var(--text-secondary);
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .sort-btn:hover {
      background: var(--hover-color);
      color: var(--active-color);
      border-color: var(--active-color);
    }

    .sort-btn.active {
      background: var(--active-color);
      color: var(--bg-dark);
      border-color: var(--active-color);
    }

    .stock-list {
      border-top: 1px solid var(--border-color);
      max-height: 400px;
      overflow-y: auto;
    }

    .stock-item {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr;
      gap: 16px;
      padding: 16px 0;
      border-bottom: 1px solid var(--border-color);
      align-items: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .stock-item:hover {
      background: var(--hover-color);
      transform: translateX(5px);
    }

    .stock-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .stock-name {
      font-weight: 600;
      font-size: 15px;
      color: var(--text-primary);
    }

    .stock-symbol {
      color: var(--text-muted);
      font-size: 13px;
      font-weight: 500;
    }

    .stock-price {
      font-weight: 600;
      font-size: 15px;
      text-align: right;
    }

    /* Shimmer Loading */
    .shimmer {
      background: linear-gradient(90deg, var(--bg-dark) 25%, var(--bg-card) 50%, var(--bg-dark) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 4px;
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    /* Notification Styles */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 0;
      min-width: 300px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transform: translateX(400px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 10000;
      overflow: hidden;
    }
    
    .notification.show {
      transform: translateX(0);
      opacity: 1;
    }
    
    .notification-content {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
    }
    
    .notification-content.success {
      border-left: 4px solid var(--up-color);
    }
    
    .notification-content.error {
      border-left: 4px solid var(--down-color);
    }
    
    .notification-content.warning {
      border-left: 4px solid #ff9800;
    }
    
    .notification-content.info {
      border-left: 4px solid #2196f3;
    }
    
    .notification-icon {
      font-size: 1.2em;
    }
    
    .notification-content.success .notification-icon {
      color: var(--up-color);
    }
    
    .notification-content.error .notification-icon {
      color: var(--down-color);
    }
    
    .notification-content.warning .notification-icon {
      color: #ff9800;
    }
    
    .notification-content.info .notification-icon {
      color: #2196f3;
    }
    
    .notification-message {
      flex: 1;
      font-size: 14px;
    }
    
    .notification-close {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
    }
    
    .notification-close:hover {
      background: var(--border-color);
      color: var(--text-primary);
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .nav-items {
        gap: 4px;
      }
      
      .nav-item {
        padding: 8px 12px;
        font-size: 13px;
      }
      
      .search-container {
        width: 300px;
      }
    }

    @media (max-width: 768px) {
      .navbar {
        padding: 0 16px;
      }
      
      .nav-row {
        flex-wrap: wrap;
      }
      
      .menu-toggle {
        display: flex;
      }
      
      .nav-items {
        display: none;
        width: 100%;
        flex-direction: column;
        gap: 8px;
        margin-top: 16px;
      }
      
      .nav-items.show {
        display: flex;
      }
      
      .header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .header-controls {
        width: 100%;
        justify-content: space-between;
      }
      
      .search-container {
        width: 100%;
      }
      
      .market-overview {
        grid-template-columns: 1fr;
      }
      
      .watchlist-section {
        grid-template-columns: 1fr;
      }
      
      .stock-item {
        grid-template-columns: 1fr auto auto;
        gap: 12px;
      }

      .chart-container {
        height: 400px;
      }
    }

    @media (max-width: 480px) {
      .main-content {
        padding: 16px;
      }
      
      .header h1 {
        font-size: 24px;
      }
      
      .market-card {
        padding: 20px;
      }
      
      .chart-container {
        height: 350px;
      }
      
      .watchlist {
        padding: 20px;
      }
    }
        /* Add these missing styles */
    .market-sentiment {
      background: var(--bg-card);
      padding: 16px 24px;
      border-radius: 16px;
      margin-bottom: 24px;
      border: 1px solid var(--border-color);
      font-weight: 600;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      backdrop-filter: blur(10px);
    }
    
    .market-sentiment.positive {
      color: var(--up-color);
      border-left: 4px solid var(--up-color);
    }
    
    .market-sentiment.negative {
      color: var(--down-color);
      border-left: 4px solid var(--down-color);
    }
    
    .stock-price-data {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }
    
    /* Loading overlay for auth check */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg-dark);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      gap: 20px;
    }
    
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid var(--border-color);
      border-top: 4px solid var(--active-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
<div class="container">
  <!-- Enhanced Navbar -->
  <header class="navbar">
    <div class="nav-wrap">
      <div class="nav-row">
        <div class="logo">
          <i class="fas fa-chart-line"></i>
          AlphaAnalytics
        </div>
        
        <button class="menu-toggle" aria-label="Toggle menu">
          <span></span>
          <span></span>
          <span></span>
        </button>

        <nav class="nav-items">
          <a href="/jeet" class="nav-item active">
            <i class="fas fa-home"></i>Dashboard
          </a>
          <a href="/portfolio" class="nav-item">
            <i class="fas fa-briefcase"></i>Portfolio
          </a>
          <a href="/mystock" class="nav-item">
            <i class="fas fa-star"></i>My Stock
          </a>
          <a href="/deposit" class="nav-item">
            <i class="fas fa-wallet"></i>Deposit
          </a>
          <a href="/insight" class="nav-item">
            <i class="fas fa-brain"></i>Insight
          </a>
          <a href="/prediction" class="nav-item">
            <i class="fas fa-crystal-ball"></i>Prediction
          </a>
          <a href="/news" class="nav-item">
            <i class="fas fa-newspaper"></i>News
          </a>
          <a href="/videos" class="nav-item">
            <i class="fas fa-play-circle"></i>Videos
          </a>
          <a href="/Superstars" class="nav-item">
            <i class="fas fa-trophy"></i>Superstars
          </a>
          <a href="/alerts" class="nav-item">
            <i class="fas fa-bell"></i>Alerts
          </a>
          <a href="/help" class="nav-item">
            <i class="fas fa-question-circle"></i>Help
          </a>
          <a href="/profile" class="nav-item">
            <i class="fas fa-user"></i>Profile
          </a>
        </nav>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header Section -->
    <div class="header">
      <h1>Advanced Market Intelligence Dashboard</h1>
      <div class="header-controls">
        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input type="text" class="search-bar" placeholder="Search stocks, indices, crypto..." id="globalSearch">
        </div>
        <div class="action-buttons">
          <button class="btn btn-primary" onclick="Dashboard.exportReport()">
            <i class="fas fa-download"></i>Export
          </button>
          <button class="btn btn-secondary" onclick="ThemeManager.toggle()">
            <i class="fas fa-palette"></i>Theme
          </button>
          <button class="btn btn-primary" onclick="Dashboard.refreshData()">
            <i class="fas fa-sync-alt"></i>Refresh
          </button>
        </div>
      </div>
    </div>

    <!-- Market Sentiment -->
    <div id="marketSentiment" class="market-sentiment"></div>

    <!-- Market Overview -->
    <div class="market-overview" id="marketOverview"></div>

    <!-- Chart Section with TradingView -->
    <div class="chart-section">
      <div class="chart-header">
        <h2>Live Market Charts</h2>
        <div class="chart-controls">
          <select id="chartSymbol" class="chart-select" onchange="ChartManager.updateSymbol(this.value)">
            <option value="NASDAQ:AAPL">Apple (AAPL)</option>
            <option value="NASDAQ:TSLA">Tesla (TSLA)</option>
            <option value="NASDAQ:MSFT">Microsoft (MSFT)</option>
            <option value="NASDAQ:GOOGL">Google (GOOGL)</option>
            <option value="NASDAQ:NVDA">NVIDIA (NVDA)</option>
            <option value="BINANCE:BTCUSDT">Bitcoin (BTC)</option>
          </select>
          <select id="chartInterval" class="chart-select" onchange="ChartManager.updateInterval(this.value)">
            <option value="1">1 Minute</option>
            <option value="5">5 Minutes</option>
            <option value="15">15 Minutes</option>
            <option value="60">1 Hour</option>
            <option value="D" selected>Daily</option>
            <option value="W">Weekly</option>
          </select>
        </div>
      </div>
      <div class="chart-container">
        <!-- TradingView Widget -->
        <div class="tradingview-widget-container">
          <div id="tradingview_widget" style="height: 100%; width: 100%;"></div>
        </div>
      </div>
    </div>

    <!-- AI Insight -->
    <div class="ai-insight">
      <div class="ai-insight-header">
        <i class="fas fa-robot ai-icon"></i>
        <h3>AI Market Intelligence</h3>
      </div>
      <div class="ai-content" id="aiInsightText">
        Analyzing market patterns and generating insights...
      </div>
    </div>

    <!-- News Ticker -->
    <div class="news-ticker">
      <div class="ticker-content" id="newsTicker">
        <!-- News items will be populated by JavaScript -->
      </div>
    </div>

    <!-- Watchlist Sections -->
    <div class="watchlist-section">
      <!-- Indian Market Movers -->
      <div class="watchlist">
        <div class="watchlist-header">
          <h2>üáÆüá≥ Top Gainers</h2>
          <div class="sort-buttons">
            <button class="sort-btn active" onclick="StockManager.sortStockList('topMoversIndian', 'changeDesc')">% Change</button>
            <button class="sort-btn" onclick="StockManager.sortStockList('topMoversIndian', 'name')">Name</button>
          </div>
        </div>
        <div class="stock-list" id="topMoversIndian"></div>
      </div>

      <!-- Indian Market Losers -->
      <div class="watchlist">
        <div class="watchlist-header">
          <h2>üáÆüá≥ Top Losers</h2>
          <div class="sort-buttons">
            <button class="sort-btn active" onclick="StockManager.sortStockList('topLosersIndian', 'changeAsc')">% Change</button>
            <button class="sort-btn" onclick="StockManager.sortStockList('topLosersIndian', 'name')">Name</button>
          </div>
        </div>
        <div class="stock-list" id="topLosersIndian"></div>
      </div>

      <!-- International Market Movers -->
      <div class="watchlist">
        <div class="watchlist-header">
          <h2>üåç Top Gainers</h2>
          <div class="sort-buttons">
            <button class="sort-btn active" onclick="StockManager.sortStockList('topMoversInternational', 'changeDesc')">% Change</button>
            <button class="sort-btn" onclick="StockManager.sortStockList('topMoversInternational', 'name')">Name</button>
          </div>
        </div>
        <div class="stock-list" id="topMoversInternational"></div>
      </div>

      <!-- International Market Losers -->
      <div class="watchlist">
        <div class="watchlist-header">
          <h2>üåç Top Losers</h2>
          <div class="sort-buttons">
            <button class="sort-btn active" onclick="StockManager.sortStockList('topLosersInternational', 'changeAsc')">% Change</button>
            <button class="sort-btn" onclick="StockManager.sortStockList('topLosersInternational', 'name')">Name</button>
          </div>
        </div>
        <div class="stock-list" id="topLosersInternational"></div>
      </div>
    </div>
  </main>
</div>
  <script>
// Configuration - Using your own backend API
const CONFIG = {
    API_BASE_URL: window.location.hostname === 'localhost' 
        ? 'http://localhost:3000' 
        : window.location.origin, // Auto-detect for deployment
    AUTO_REFRESH_INTERVAL: 300000, // 5 minutes
    CACHE_DURATION: 5 * 60 * 1000 // 5 minutes
};

// Market Data - Updated for yfinance format (.NS for NSE)
const NSE_TICKER_NAMES = {
    "RELIANCE.NS": "Reliance Industries",
    "TCS.NS": "Tata Consultancy Services", 
    "HDFCBANK.NS": "HDFC Bank",
    "INFY.NS": "Infosys",
    "ICICIBANK.NS": "ICICI Bank",
    "SBIN.NS": "State Bank of India",
    "BHARTIARTL.NS": "Bharti Airtel",
    "ITC.NS": "ITC Limited",
    "KOTAKBANK.NS": "Kotak Mahindra Bank",
    "AXISBANK.NS": "Axis Bank"
};

const INTERNATIONAL_TICKER_NAMES = {
    "AAPL": "Apple Inc.",
    "MSFT": "Microsoft Corporation",
    "GOOGL": "Alphabet Inc.",
    "AMZN": "Amazon.com Inc.", 
    "TSLA": "Tesla Inc.",
    "NVDA": "NVIDIA Corporation",
    "META": "Meta Platforms Inc.",
    "JPM": "JPMorgan Chase",
    "V": "Visa Inc.",
    "JNJ": "Johnson & Johnson"
};

// Market indices for yfinance
const MARKET_INDICES = {
    "NIFTY_50": { symbol: "^NSEI", name: "NIFTY 50", currency: "‚Çπ" },
    "SENSEX": { symbol: "^BSESN", name: "SENSEX", currency: "‚Çπ" },
    "NASDAQ": { symbol: "^IXIC", name: "NASDAQ", currency: "$" },
    "SP500": { symbol: "^GSPC", name: "S&P 500", currency: "$" },
    "DOW": { symbol: "^DJI", name: "Dow Jones", currency: "$" }
};

const NSE_TICKERS = Object.keys(NSE_TICKER_NAMES);
const INTERNATIONAL_TICKERS = Object.keys(INTERNATIONAL_TICKER_NAMES);

// Fallback Data (if yfinance fails)
const FALLBACK_DATA = {
    INDIAN: [
        { symbol: "RELIANCE.NS", name: "Reliance Industries", price: 2856.50, changePercent: 2.35 },
        { symbol: "TCS.NS", name: "Tata Consultancy Services", price: 3850.75, changePercent: 1.85 },
        { symbol: "INFY.NS", name: "Infosys", price: 1650.25, changePercent: 1.52 },
        { symbol: "HDFCBANK.NS", name: "HDFC Bank", price: 1658.40, changePercent: 1.23 },
        { symbol: "ICICIBANK.NS", name: "ICICI Bank", price: 1056.80, changePercent: 0.95 }
    ],
    INTERNATIONAL: [
        { symbol: "AAPL", name: "Apple Inc.", price: 218.35, changePercent: 3.25 },
        { symbol: "NVDA", name: "NVIDIA Corporation", price: 950.02, changePercent: 2.85 },
        { symbol: "MSFT", name: "Microsoft Corporation", price: 415.50, changePercent: 2.15 },
        { symbol: "TSLA", name: "Tesla Inc.", price: 245.75, changePercent: 1.75 },
        { symbol: "META", name: "Meta Platforms Inc.", price: 485.60, changePercent: 1.45 }
    ]
};

// Application State
const AppState = {
    stockData: {
        topMoversIndian: [],
        topLosersIndian: [],
        topMoversInternational: [],
        topLosersInternational: []
    },
    marketIndices: {},
    isInitialized: false,
    refreshInterval: null,
    cache: new Map(),
    currentUser: null
};

// Authentication Service
class AuthService {
    static async checkAuth() {
        try {
            const response = await fetch(`${CONFIG.API_BASE_URL}/api/auth/status`, {
                method: 'GET',
                credentials: 'include'
            });
            
            if (!response.ok) throw new Error('Not authenticated');
            const data = await response.json();
            return data.authenticated ? data.user : null;
        } catch (error) {
            console.log('Auth check failed:', error);
            return null;
        }
    }
    
    static async logout() {
        try {
            await fetch(`${CONFIG.API_BASE_URL}/logout`, {
                method: 'POST',
                credentials: 'include'
            });
            window.location.href = '/';
        } catch (error) {
            console.error('Logout error:', error);
        }
    }
    
    static async getUserProfile() {
        try {
            const response = await fetch(`${CONFIG.API_BASE_URL}/me`, {
                method: 'GET',
                credentials: 'include'
            });
            if (!response.ok) throw new Error('Failed to get profile');
            return await response.json();
        } catch (error) {
            console.error('Get profile error:', error);
            return null;
        }
    }
}

// YFinance API Service
class YFinanceService {
    static async getQuote(symbol) {
        try {
            const response = await fetch(`${CONFIG.API_BASE_URL}/api/yfinance/quote/${symbol}`, {
                method: 'GET',
                credentials: 'include'
            });
            
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            return await response.json();
        } catch (error) {
            console.error(`Failed to fetch quote for ${symbol}:`, error);
            return null;
        }
    }
    
    static async getMultipleQuotes(symbols) {
        try {
            const symbolsQuery = symbols.join(',');
            const response = await fetch(
                `${CONFIG.API_BASE_URL}/api/yfinance/quotes?symbols=${symbolsQuery}`,
                { method: 'GET', credentials: 'include' }
            );
            
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            return await response.json();
        } catch (error) {
            console.error('Failed to fetch multiple quotes:', error);
            return [];
        }
    }
    
    static async getHistoricalData(symbol, period = '1mo', interval = '1d') {
        try {
            const response = await fetch(
                `${CONFIG.API_BASE_URL}/api/yfinance/historical/${symbol}?period=${period}&interval=${interval}`,
                { method: 'GET', credentials: 'include' }
            );
            
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            return await response.json();
        } catch (error) {
            console.error(`Failed to fetch historical for ${symbol}:`, error);
            return [];
        }
    }
    
    static async getMarketIndices() {
        const indices = Object.values(MARKET_INDICES);
        try {
            const quotes = await Promise.all(
                indices.map(index => this.getQuote(index.symbol))
            );
            
            return indices.map((index, i) => ({
                ...index,
                quote: quotes[i]
            })).filter(item => item.quote);
        } catch (error) {
            console.error('Failed to fetch market indices:', error);
            return [];
        }
    }
}

// Mobile Menu Controller
class MobileMenu {
    constructor() {
        this.menuToggle = document.querySelector('.menu-toggle');
        this.navItems = document.querySelector('.nav-items');
        this.isOpen = false;
        this.init();
    }

    init() {
        if (this.menuToggle && this.navItems) {
            this.menuToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                this.toggle();
            });

            this.setupClickOutsideHandler();
        }
    }

    toggle() {
        this.isOpen = !this.isOpen;
        this.navItems.classList.toggle('show');
        
        const spans = this.menuToggle.querySelectorAll('span');
        spans.forEach(span => span.classList.toggle('active'));
    }

    close() {
        this.isOpen = false;
        this.navItems.classList.remove('show');
        const spans = this.menuToggle.querySelectorAll('span');
        spans.forEach(span => span.classList.remove('active'));
    }

    setupClickOutsideHandler() {
        document.addEventListener('click', (event) => {
            if (this.isOpen && !event.target.closest('.navbar')) {
                this.close();
            }
        });
    }
}

// Notification Manager
class NotificationManager {
    static show(message, type = 'info') {
        let notification = document.getElementById('dashboardNotification');
        if (!notification) {
            notification = document.createElement('div');
            notification.id = 'dashboardNotification';
            notification.className = 'notification';
            document.body.appendChild(notification);
        }

        const icons = {
            success: 'fa-check-circle',
            error: 'fa-exclamation-circle',
            warning: 'fa-exclamation-triangle',
            info: 'fa-info-circle'
        };

        notification.innerHTML = `
            <div class="notification-content ${type}">
                <i class="fas ${icons[type] || icons.info} notification-icon"></i>
                <span class="notification-message">${message}</span>
                <button class="notification-close" onclick="this.parentElement.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `;

        notification.classList.add('show');

        setTimeout(() => {
            if (notification.parentElement) {
                notification.remove();
            }
        }, 5000);
    }
}

// Chart Manager with TradingView
class ChartManager {
    static currentWidget = null;
    
    static initialize() {
        this.loadTradingViewScript().then(() => {
            this.createChart();
            NotificationManager.show('Live charts loaded successfully', 'success');
        }).catch(error => {
            console.error('Failed to load TradingView:', error);
            this.createFallbackChart();
            NotificationManager.show('Using fallback charts', 'warning');
        });
    }

    static loadTradingViewScript() {
        return new Promise((resolve, reject) => {
            if (window.TradingView) {
                resolve();
                return;
            }

            const script = document.createElement('script');
            script.src = 'https://s3.tradingview.com/tv.js';
            script.type = 'text/javascript';
            script.onload = resolve;
            script.onerror = reject;
            document.head.appendChild(script);
        });
    }

    static createChart(symbol = "NASDAQ:AAPL", interval = "D") {
        if (this.currentWidget) {
            this.currentWidget.remove();
        }

        this.currentWidget = new TradingView.widget({
            "autosize": true,
            "symbol": symbol,
            "interval": interval,
            "timezone": "America/New_York",
            "theme": this.getTheme(),
            "style": "1",
            "locale": "en",
            "toolbar_bg": "#0f0f23",
            "enable_publishing": false,
            "allow_symbol_change": true,
            "container_id": "tradingview_widget",
            "studies": [
                "RSI@tv-basicstudies",
                "MACD@tv-basicstudies",
                "Volume@tv-basicstudies"
            ],
            "show_popup_button": true,
            "popup_width": "1000",
            "popup_height": "650",
            "disabled_features": [
                "use_localstorage_for_settings",
                "header_widget_dom_node"
            ],
            "enabled_features": [
                "study_templates",
                "hide_left_toolbar_by_default"
            ]
        });
    }

    static updateSymbol(symbol) {
        const interval = document.getElementById('chartInterval')?.value || 'D';
        this.createChart(symbol, interval);
        NotificationManager.show(`Chart updated to ${symbol}`, 'info');
    }

    static updateInterval(interval) {
        const symbol = document.getElementById('chartSymbol')?.value || 'NASDAQ:AAPL';
        this.createChart(symbol, interval);
        NotificationManager.show(`Interval changed to ${interval}`, 'info');
    }

    static getTheme() {
        return document.body.classList.contains('light') ? "light" : "dark";
    }

    static createFallbackChart() {
        const container = document.getElementById('tradingview_widget');
        container.innerHTML = `
            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: var(--text-muted); padding: 20px; text-align: center;">
                <i class="fas fa-chart-line" style="font-size: 64px; margin-bottom: 20px; color: var(--active-color);"></i>
                <h3 style="margin-bottom: 12px; color: var(--text-primary);">Advanced Charting</h3>
                <p style="margin-bottom: 20px; line-height: 1.6;">Real-time charts powered by TradingView. Interactive technical analysis with multiple indicators and drawing tools.</p>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 20px;">
                    <div style="background: var(--bg-card); padding: 12px; border-radius: 8px;">
                        <i class="fas fa-bolt" style="color: var(--up-color);"></i>
                        <div>Real-time Data</div>
                    </div>
                    <div style="background: var(--bg-card); padding: 12px; border-radius: 8px;">
                        <i class="fas fa-chart-bar" style="color: var(--active-color);"></i>
                        <div>Technical Indicators</div>
                    </div>
                    <div style="background: var(--bg-card); padding: 12px; border-radius: 8px;">
                        <i class="fas fa-draw-polygon" style="color: var(--accent-purple);"></i>
                        <div>Drawing Tools</div>
                    </div>
                    <div style="background: var(--bg-card); padding: 12px; border-radius: 8px;">
                        <i class="fas fa-exchange-alt" style="color: var(--accent-teal);"></i>
                        <div>Multiple Timeframes</div>
                    </div>
                </div>
            </div>
        `;
    }
}

// Stock Manager (using yfinance)
class StockManager {
    static getStockName(symbol, isInternational = false) {
        // Remove .NS suffix for display
        const displaySymbol = symbol.replace('.NS', '');
        return isInternational ? INTERNATIONAL_TICKER_NAMES[displaySymbol] || displaySymbol : NSE_TICKER_NAMES[symbol] || displaySymbol;
    }

    static async updateMarketMoversLosers(tickers, moversContainerId, losersContainerId, isInternational = false) {
        console.log(`Updating ${isInternational ? 'International' : 'Indian'} market data...`);
        
        this.showLoadingPlaceholder(moversContainerId);
        this.showLoadingPlaceholder(losersContainerId);

        try {
            const data = await YFinanceService.getMultipleQuotes(tickers);
            
            if (!data || data.length === 0) {
                throw new Error("No data received from yfinance");
            }

            // Process yfinance data
            const processedData = data.map(quote => ({
                symbol: quote.symbol,
                name: quote.name || this.getStockName(quote.symbol, isInternational),
                price: quote.price,
                change: quote.change,
                changePercent: quote.changePercent || ((quote.change / (quote.price - quote.change)) * 100),
                currency: quote.currency
            })).filter(stock => stock.price > 0);

            if (processedData.length === 0) {
                throw new Error("No valid data received");
            }

            const gainers = processedData
                .filter(stock => stock.changePercent > 0)
                .sort((a, b) => b.changePercent - a.changePercent)
                .slice(0, 5);

            const losers = processedData
                .filter(stock => stock.changePercent < 0)
                .sort((a, b) => a.changePercent - b.changePercent)
                .slice(0, 5);

            // Use fallback if no gainers/losers
            if (gainers.length === 0 || losers.length === 0) {
                const fallbackData = isInternational ? FALLBACK_DATA.INTERNATIONAL : FALLBACK_DATA.INDIAN;
                const allData = processedData.length > 0 ? processedData : fallbackData;
                
                if (gainers.length === 0) {
                    gainers.push(...allData.slice(0, 3).map(stock => ({
                        ...stock,
                        changePercent: Math.random() * 5 + 0.5
                    })));
                }
                
                if (losers.length === 0) {
                    losers.push(...allData.slice(3, 6).map(stock => ({
                        ...stock,
                        changePercent: -(Math.random() * 3 + 0.5)
                    })));
                }
            }

            AppState.stockData[moversContainerId] = gainers;
            AppState.stockData[losersContainerId] = losers;

            this.renderStocks(moversContainerId, gainers, isInternational);
            this.renderStocks(losersContainerId, losers, isInternational);

        } catch (error) {
            console.error("Error updating market data:", error);
            
            // Use fallback data
            const fallbackData = isInternational ? FALLBACK_DATA.INTERNATIONAL : FALLBACK_DATA.INDIAN;
            const gainers = fallbackData.slice(0, 3);
            const losers = fallbackData.slice(3, 5).map(stock => ({
                ...stock,
                changePercent: -(Math.abs(stock.changePercent))
            }));

            this.renderStocks(moversContainerId, gainers, isInternational);
            this.renderStocks(losersContainerId, losers, isInternational);
            
            NotificationManager.show('Using fallback market data', 'warning');
        }
    }

    static renderStocks(containerId, stocks, isInternational = false) {
        const container = document.getElementById(containerId);
        if (!container) return;
        
        container.innerHTML = "";
        
        if (!stocks || stocks.length === 0) {
            container.innerHTML = `
                <div style="padding: 40px 20px; text-align: center; color: var(--text-muted);">
                    <i class="fas fa-chart-line" style="font-size: 32px; margin-bottom: 12px;"></i>
                    <div>No data available</div>
                </div>`;
            return;
        }

        stocks.forEach(stock => {
            const priceFormatted = isInternational ? `$${stock.price?.toFixed(2) || stock.close?.toFixed(2) || 'N/A'}` 
                : `‚Çπ${stock.price?.toFixed(2) || stock.close?.toFixed(2) || 'N/A'}`;
            const changePercent = stock.changePercent || stock.percentChange || 0;
            const changeClass = changePercent >= 0 ? "positive" : "negative";
            const arrow = changePercent >= 0 ? "üìà" : "üìâ";
            const changeIcon = changePercent >= 0 ? "üü¢" : "üî¥";

            // Clean symbol for display
            const displaySymbol = stock.symbol.replace('.NS', '');

            const stockDiv = document.createElement("div");
            stockDiv.className = "stock-item";
            stockDiv.innerHTML = `
                <div class="stock-info">
                    <span class="stock-name">${stock.name}</span>
                    <span class="stock-symbol">${displaySymbol}</span>
                </div>
                <div class="stock-price-data">
                    <span class="stock-price">${priceFormatted}</span>
                    <span class="stock-change ${changeClass}">
                        ${changeIcon} ${Math.abs(changePercent).toFixed(2)}% ${arrow}
                    </span>
                </div>`;
            container.appendChild(stockDiv);
        });
    }

    static showLoadingPlaceholder(containerId, count = 5) {
        const container = document.getElementById(containerId);
        if (!container) return;
        
        container.innerHTML = "";
        for (let i = 0; i < count; i++) {
            const row = document.createElement("div");
            row.className = "stock-item loading";
            row.innerHTML = `
                <div class="stock-info">
                    <div class="shimmer" style="width:120px; height:16px;"></div>
                    <div class="shimmer" style="width:80px; height:12px;"></div>
                </div>
                <div class="stock-price-data">
                    <div class="shimmer" style="width:60px; height:16px;"></div>
                    <div class="shimmer" style="width:70px; height:14px;"></div>
                </div>`;
            container.appendChild(row);
        }
    }

    static sortStockList(containerId, sortBy) {
        const stocks = [...AppState.stockData[containerId]];
        if (!stocks.length) return;
        
        let sortedStocks = [...stocks];
        
        if (sortBy === "name") {
            sortedStocks.sort((a, b) => a.name.localeCompare(b.name));
        } else if (sortBy === "changeAsc") {
            sortedStocks.sort((a, b) => (a.changePercent || a.percentChange || 0) - (b.changePercent || b.percentChange || 0));
        } else if (sortBy === "changeDesc") {
            sortedStocks.sort((a, b) => (b.changePercent || b.percentChange || 0) - (a.changePercent || a.percentChange || 0));
        }
        
        const isInternational = containerId.includes("International");
        this.renderStocks(containerId, sortedStocks, isInternational);
        
        // Update active button
        const buttons = document.querySelectorAll(`#${containerId} ~ .watchlist-header .sort-btn`);
        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
    }
}

// Theme Manager
class ThemeManager {
    static toggle() {
        document.body.classList.toggle('light');
        const isLight = document.body.classList.contains('light');
        localStorage.setItem('theme', isLight ? 'light' : 'dark');
        NotificationManager.show(`Theme changed to ${isLight ? 'light' : 'dark'} mode`, 'info');
        
        // Reinitialize chart with new theme
        if (window.TradingView) {
            ChartManager.initialize();
        }
    }

    static load() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            document.body.classList.add('light');
        }
    }
}

// User Profile Manager
class UserManager {
    static async updateUserProfile() {
        try {
            const user = await AuthService.getUserProfile();
            if (user) {
                AppState.currentUser = user;
                
                // Update profile in navbar if exists
                const profileLink = document.querySelector('a[href="/profile"]');
                if (profileLink) {
                    profileLink.innerHTML = `<i class="fas fa-user"></i> ${user.username}`;
                }
            }
        } catch (error) {
            console.error('Update profile error:', error);
        }
    }
}

// Dashboard Manager
class Dashboard {
    static async initialize() {
        console.log("üöÄ Initializing Financial Dashboard...");
        
        // Check authentication (optional - remove if you want public access)
        try {
            const user = await AuthService.checkAuth();
            if (user) {
                AppState.currentUser = user;
                await UserManager.updateUserProfile();
            }
        } catch (error) {
            console.log('Auth optional - continuing without user');
        }
        
        // Load theme
        ThemeManager.load();
        
        // Initialize components
        new MobileMenu();
        ChartManager.initialize();
        
        // Initialize market data
        this.initializeMarketData();
        
        // Set up auto-refresh
        this.setupAutoRefresh();
        
        // Setup search
        this.setupSearch();
        
        // Setup logout if user is logged in
        if (AppState.currentUser) {
            this.setupLogout();
        }
        
        AppState.isInitialized = true;
        console.log("‚úÖ Financial Dashboard initialized successfully");
        
        NotificationManager.show('Dashboard loaded successfully!', 'success');
    }

    static async initializeMarketData() {
        // Update Indian market data
        StockManager.updateMarketMoversLosers(NSE_TICKERS, "topMoversIndian", "topLosersIndian", false);
        
        // Update International market data
        StockManager.updateMarketMoversLosers(INTERNATIONAL_TICKERS, "topMoversInternational", "topLosersInternational", true);
        
        // Update market indices
        await this.updateMarketIndices();
        
        // Update other components
        this.updateAIInsight();
        this.updateNewsTicker();
    }
    
    static async updateMarketIndices() {
        try {
            const indices = await YFinanceService.getMarketIndices();
            AppState.marketIndices = indices;
            this.renderMarketIndices(indices);
        } catch (error) {
            console.error('Failed to update market indices:', error);
            this.renderMarketIndices([]);
        }
    }
    
    static renderMarketIndices(indices) {
        const el = document.getElementById("marketOverview");
        if (!el) return;
        
        if (!indices || indices.length === 0) {
            // Fallback to static data
            const fallbackData = [
                { name: "NIFTY 50", currency: "‚Çπ", quote: { price: 24500, changePercent: 0.85 } },
                { name: "SENSEX", currency: "‚Çπ", quote: { price: 82000, changePercent: -0.55 } },
                { name: "NASDAQ", currency: "$", quote: { price: 16500, changePercent: 1.25 } },
                { name: "S&P 500", currency: "$", quote: { price: 5200, changePercent: 0.75 } }
            ];
            this.renderIndicesHTML(fallbackData);
            return;
        }
        
        this.renderIndicesHTML(indices);
        
        // Update sentiment
        this.updateMarketSentiment(indices);
    }
    
    static renderIndicesHTML(indices) {
        const el = document.getElementById("marketOverview");
        el.innerHTML = indices.map(index => `
            <div class="market-card">
                <h3>${index.name}</h3>
                <div class="market-value">${index.currency}${index.quote?.price?.toLocaleString() || 'N/A'}</div>
                <span class="stock-change ${index.quote?.changePercent >= 0 ? "positive" : "negative"}">
                    ${index.quote?.changePercent >= 0 ? "üìà" : "üìâ"} 
                    ${index.quote?.changePercent ? Math.abs(index.quote.changePercent).toFixed(2) + '%' : 'N/A'}
                </span>
            </div>
        `).join('');
    }
    
    static updateMarketSentiment(indices) {
        const sentimentEl = document.getElementById("marketSentiment");
        if (!sentimentEl) return;
        
        if (indices.length === 0) {
            sentimentEl.textContent = 'Market Sentiment: üîµ NEUTRAL (No data)';
            sentimentEl.className = 'market-sentiment';
            return;
        }
        
        const totalChange = indices.reduce((sum, index) => 
            sum + (index.quote?.changePercent || 0), 0
        );
        const avgChange = totalChange / indices.length;
        
        let sentiment, className;
        if (avgChange > 2) {
            sentiment = "üü¢ STRONGLY BULLISH";
            className = "positive";
        } else if (avgChange > 0.5) {
            sentiment = "üü¢ BULLISH";
            className = "positive";
        } else if (avgChange > -0.5) {
            sentiment = "üîµ NEUTRAL";
            className = "";
        } else if (avgChange > -2) {
            sentiment = "üî¥ BEARISH";
            className = "negative";
        } else {
            sentiment = "üî¥ STRONGLY BEARISH";
            className = "negative";
        }
        
        sentimentEl.textContent = `Market Sentiment: ${sentiment} (${avgChange.toFixed(2)}%)`;
        sentimentEl.className = `market-sentiment ${className}`;
    }

    static updateAIInsight() {
        const insights = [
            "AI detects strong institutional buying in technology stocks. Consider accumulating quality tech names.",
            "Market showing consolidation patterns. Technical analysis suggests potential breakout above key resistance.",
            "Banking sector fundamentals remain strong with improving asset quality and credit growth.",
            "Global cues positive as inflation concerns ease across major economies.",
            "Momentum indicators suggest continued strength in large-cap stocks with earnings momentum.",
            "AI analysis shows oversold conditions in mid-cap segment, potential buying opportunity emerging."
        ];
        const idx = Math.floor(Math.random() * insights.length);
        const insightEl = document.getElementById("aiInsightText");
        if (insightEl) {
            insightEl.textContent = insights[idx];
        }
    }

    static updateNewsTicker() {
        const newsItems = [
            { symbol: "AAPL", text: "Apple announces new AI features for iOS 18", change: 2.5 },
            { symbol: "TSLA", text: "Tesla deliveries beat estimates in Q1", change: 4.2 },
            { symbol: "NVDA", text: "NVIDIA unveils next-gen AI chips", change: 5.8 },
            { symbol: "RELIANCE", text: "Reliance Jio reports strong subscriber growth", change: 1.8 },
            { symbol: "INFY", text: "Infosys signs $500M digital transformation deal", change: 3.1 },
            { symbol: "BTC-USD", text: "Bitcoin breaks $45,000 as institutional adoption grows", change: 6.2 }
        ];

        const ticker = document.getElementById('newsTicker');
        if (ticker) {
            ticker.innerHTML = newsItems.map(item => `
                <div class="ticker-item">
                    <span class="ticker-badge">${item.symbol}</span>
                    <span>${item.text}</span>
                    <span class="stock-change ${item.change >= 0 ? 'positive' : 'negative'}">
                        ${item.change >= 0 ? '+' : ''}${item.change}%
                    </span>
                </div>
            `).join('');
        }
    }

    static setupAutoRefresh() {
        if (AppState.refreshInterval) {
            clearInterval(AppState.refreshInterval);
        }

        AppState.refreshInterval = setInterval(() => {
            console.log("üîÑ Auto-refreshing market data...");
            this.initializeMarketData();
        }, CONFIG.AUTO_REFRESH_INTERVAL);
    }

    static setupSearch() {
        const searchInput = document.getElementById('globalSearch');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                if (query.length > 2) {
                    console.log('Searching for:', query);
                    NotificationManager.show(`Searching for: ${query}`, 'info');
                }
            });
        }
    }
    
    static setupLogout() {
        const profileLink = document.querySelector('a[href="/profile"]');
        if (profileLink && AppState.currentUser) {
            profileLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (confirm('Are you sure you want to logout?')) {
                    AuthService.logout();
                }
            });
        }
    }

    static exportReport() {
        NotificationManager.show('Exporting dashboard report...', 'info');
        setTimeout(() => {
            NotificationManager.show('Report exported successfully!', 'success');
        }, 2000);
    }

    static refreshData() {
        NotificationManager.show('Refreshing market data...', 'info');
        this.initializeMarketData();
    }
    
    static logout() {
        AuthService.logout();
    }
}

// Initialize the application
document.addEventListener('DOMContentLoaded', () => {
    Dashboard.initialize();
});

// Global error handling
window.addEventListener('error', (event) => {
    console.error('Global error:', event.error);
    NotificationManager.show('An unexpected error occurred', 'error');
});

// Make functions globally available
window.toggleTheme = ThemeManager.toggle;
window.exportReport = Dashboard.exportReport;
window.refreshDashboard = Dashboard.refreshData;
window.logout = Dashboard.logout;
</script>
</body>
</html>